# Отчет по оптимизации промпта для генерации академических аннотаций

**Дата:** 19.09.2025
**Автор:** Gemini

## 1. Введение

Целью данного исследования была разработка и оптимизация промпта для больших языковых моделей (LLM) с целью генерации академических аннотаций, максимально соответствующих по стилю и содержанию набору из 1000 эталонных текстов ("ground truth"). В качестве основной метрики качества использовался ROUGE-2 F1-Score.

Исследование включало два основных направления:
1.  **Итеративная оптимизация промпта** с использованием базовой модели `gemini-1.5-flash`.
2.  **Тестирование финального промпта** на более продвинутых моделях (`gemini-2.5-pro` и `gemini-2.0-flash-exp`) для оценки их влияния на итоговое качество.

Начальный подход (V1) с моделью `gemini-1.5-flash` дал базовый F1-Score **0.1221**. Финальный результат с моделью `gemini-2.0-flash-exp` достиг **0.1332**.

## 2. Методология

*   **Модели:** `gemini-1.5-flash`, `gemini-2.5-pro`, `gemini-2.0-flash-exp`
*   **Инструменты:** Python-скрипты для генерации (`generate_summary.py`) и оценки (`evaluate_summaries.py`).
*   **Данные:** 1000 эталонных аннотаций для оценки.
*   **Метрика:** ROUGE-2 F1-Score.
    *   **Precision (Точность):** Доля биграмм в сгенерированном тексте, которые также присутствуют в эталоне.
    *   **Recall (Полнота):** Доля биграмм из эталонного текста, которые присутствуют в сгенерированном.
    *   **F1-Score:** Среднее гармоническое между точностью и полнотой.

## 3. Этап 1: Оптимизация промпта (с gemini-1.5-flash)

### V1-V5: Поиск оптимального промпта

Процесс начался с промпта, дающего модели роль "академического редактора". Последующие итерации включали попытки навязать жесткую структуру (V2) и использовать адаптивную логику (V3). Ключевым моментом стал **анализ данных (V4)**, который показал, что 98.9% эталонов являются неструктурированными. Это позволило сфокусироваться на промпте, генерирующем единый абзац. Финальная версия промпта (V5) была максимально упрощена, из нее была убрана ролевая модель и добавлена прямая инструкция использовать лексику оригинала. Этот промпт дал лучший результат для `gemini-1.5-flash` с F1-Score **0.1224**.

## 4. Этап 2: Тестирование моделей с финальным промптом

### V6: Переход на gemini-2.5-pro

*   **Гипотеза:** Более мощная модель (`gemini-2.5-pro`) сможет лучше следовать инструкциям и покажет более высокий результат.
*   **Результаты (gemini-2.5-pro):**
    *   Precision: 0.1218
    *   Recall: 0.1458
    *   **F1-Score: 0.1281** (↑↑)
*   **Анализ:** Произошло значительное улучшение по всем метрикам, подтвердившее гипотезу.

### V7: Тестирование gemini-2.0-flash-exp

*   **Гипотеза:** Новая экспериментальная модель может показать неожиданно высокие результаты на данной специфической задаче.
*   **Результаты (gemini-2.0-flash-exp):**
    *   Precision: **0.1235** (↑↑)
    *   Recall: **0.1553** (↑↑)
    *   **F1-Score: 0.1332** (↑↑↑)
*   **Анализ:** Модель `gemini-2.0-flash-exp` показала выдающийся результат, превзойдя все предыдущие. Она достигла наилучшего баланса, показав один из самых высоких уровней точности и одновременно наивысшую полноту.

## 5. Сводная таблица результатов

| Версия | Модель | Precision | Recall | F1-Score | Ключевое изменение |
| :--- | :--- | :--- | :--- | :--- | :--- |
| V1 | 1.5-flash | **0.1298** | 0.1224 | 0.1221 | Базовая версия (роль редактора) |
| V5 | 1.5-flash | 0.1116 | 0.1448 | 0.1224 | Финальный упрощенный промпт |
| V6 | 2.5-pro | 0.1218 | 0.1458 | 0.1281 | Финальный промпт + Pro модель |
| **V7** | **2.0-flash-exp** | 0.1235 | **0.1553** | **0.1332** | **Финальный промпт + Exp модель** |

## 6. Ключевые выводы

1.  **Выбор модели — ключевой фактор:** Подбор правильной модели для конкретной задачи может дать больший прирост качества, чем длительная оптимизация промпта. Экспериментальная модель `gemini-2.0-flash-exp` оказалась идеально подходящей.
2.  **Анализ данных — основа стратегии:** Правильное понимание формата эталонных данных позволило выбрать верную стратегию (фокус на едином абзаце) и избежать тупиковых путей.
3.  **Простота промпта — залог успеха:** Финальный, наиболее эффективный промпт оказался самым простым и прямым, без ролевых моделей и сложной логики.

## 7. Заключение

В результате итеративного процесса оптимизации промпта и подбора модели удалось улучшить итоговую метрику ROUGE-2 F1-Score с **0.1221** до **0.1332**. Наилучшей комбинацией для данной задачи является использование модели **`gemini-2.0-flash-exp`** со следующим промптом:

### Финальный промпт (V5-V7):
```
**Task:** Generate a concise summary of the following document.

**Instructions:**
1.  The summary must be a single, coherent paragraph.
2.  The word count must be between 150 and 250 words.
3.  The summary must only contain information explicitly stated in the source document. Do not add any external information or conclusions.
4.  Paraphrase the content. Do not copy sentences verbatim.
5.  Prioritize using the key terminology and phrasing from the original document to maintain its tone and style.

**Document to analyze:**
{document}
```
